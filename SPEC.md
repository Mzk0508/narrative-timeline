# 📄 Narrative Analysis Timeline (v2) 仕様書

## 1. プロジェクト概要

本プロジェクトは、ソフトバンクグループの歴史的変遷と、それを取り巻く社会・制度の変化を可視化する「スイムレーン型年表アプリケーション」である。

単なる時系列の羅列ではなく、**「コンテキスト（Field）」「制度（Institution）」「変革者（Game Changer）」「影響（Rule Change）」**の相互作用を分析するための「ナラティブ分析ツール」として機能する。

## 2. ディレクトリ構成

```
projects/
└── data_analysis/
    └── swimlane_timeline/
        ├── index.html           # ロジックを含むメインファイル
        ├── swimlane_timeline.css # デザイン定義ファイル
        └── SPEC.md              # 本仕様書
```

## 3. デザインコンセプト: "Navy Admiral"

学術的な信頼性（Academic Integrity）と、プレゼンテーションとしての視認性を両立させるデザインシステムを採用する。

- **ベーステーマ**: フラットデザイン、高コントラスト
- **左ヘッダー**: `Deep Navy (#063763)` を基調としたダークサイドバー。画面全体を引き締め、情報の「見出し」としての役割を強調する。
- **右タイムライン**: `White (#ffffff)` ベース。紙媒体のような可読性を確保。

### 🎨 カラーパレット (Semantic Colors)

各レーンには意味に基づいた色が割り当てられる。

| レーン (Role) | 色調 | Hex Code | 意図 |
| :--- | :--- | :--- | :--- |
| **Field** (背景) | Cool Gray | `#94a3b8` | 客観的な事実、背景情報として主張を抑える。 |
| **Institution** (制度) | Deep Teal | `#0f766e` | 権威、安定、システムを表す寒色。 |
| **Game Changer** (SB) | **Burnt Orange** | **`#c2410c`** | **唯一の暖色**。変革のエネルギーと特異性を強調。 |
| **Rule Change** (影響) | Slate | `#334155` | 結果として定着したルール。重厚な色。 |

## 4. 技術アーキテクチャ: "Time-Grid Layout Engine"

従来の「年単位」の配置ではなく、より精密な「月単位」の可変グリッドシステムを採用する。

### 4.1. データ構造 (JSON Schema)

```json
{
  "lanes": { "4": "Field", "3": "Institution", ... },
  "events": [
    {
      "year": 1981.75,  // 小数点以下は月を表す (0.75 = 9月頃)
      "lane": 2,
      "text": "Event Description..."
    }
  ]
}
```

### 4.2. レイアウトアルゴリズム (Layout Logic)

#### Time Bucket Classification

すべてのイベントを「年-月」ごとのバケットに分類する。

#### Dynamic Grid Sizing (可変幅計算)

- **イベントがある月**: イベント幅 (240px) + 余白 を確保。
- **イベントがない月**: Collapsed Width (30px) に圧縮。

これにより、歴史的な空白期間は短縮され、密度の高い期間は詳細に表示される「メリハリのあるリズム」を生み出す。

#### Virtual Positioning (仮想座標計算)

DOM生成前に全座標 (x, y) を事前計算し、描画時の再計算コスト（Reflow）を最小化する。

### 4.3. 同期システム (Sync System)

- **スクロール同期**: timeline-wrapper (横スクロール) と year-axis (年軸) をJavaScriptでイベントリスナーにより完全同期させる。
- **高さ同期**: ResizeObserver を使用せず、`window.innerHeight` から算出した固定値を、ヘッダーとレーンの両方に適用することで、サブピクセルレンダリングによる1pxのズレも許容しない堅牢なレイアウトを実現する。

## 5. UIコンポーネント仕様

### Event Box (イベントカード)

- **形状**: 角丸 (4px)、左端に各レーン色のボーダーライン (4px)。

- **振る舞い**:
  - 初期状態: `visibility: visible`, `z-index: 20`
  - ホバー時: わずかに影を強調 (`box-shadow`)。派手な拡大アニメーションは排除し、データを読むことを妨げない。

- **テキスト処理**: `(e.g., ...)` などの補足情報はそのまま表示し、データの加工は最小限に留める（データの真正性維持）。
